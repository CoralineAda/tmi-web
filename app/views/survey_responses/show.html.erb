<h2>Response <%= @response.identifier %></h2>

<% if @previous_response %>
	<div class="flip" id="flip-left">
		<%= link_to "<", survey_response_path(@previous_response, q: @theme) %>
	</div>
<% end %>
<% if @next_response %>
	<div class="flip" id="flip-right">
		<%= link_to ">", survey_response_path(@next_response, q: @theme) %>
	</div>
<% end %>

<h3>Derived Themes:</h3>

<ul class="word-cloud">
	<% @response.themes.sort.each do |theme| %>
		<% active = theme == @theme ? "active" : "" %>
		<li class="<%= active %>"><%= link_to theme, survey_responses_path(q: theme) %></li>
	<% end %>
</ul>


<%= form_with model: @response do |f| %>
	<table>
		<thead>
			<tr>
				<th>Survey Question</th>
				<th>Response</th>
				<th>Tags</th>
			</tr>
		</thead>
		<tbody>
			<% counter = 0 %>
			<% SurveyResponse::QUESTION_MAPPING.each do |field,label| %>
				<% alt = counter % 2 == 1 ? "" : "alt" %>
				<% counter += 1 %>
				<tr class="<%= alt %>">
					<td class="label"><a href="/question?q=<%= field %>" class="jump-link"><%= label %></a></td>
					<td><%= @response.read_attribute(field) %></td>
					<td class="form-entry">
						<% fieldname = field.to_s.split("_")[0..-2].join('_') %>
						<% if field.to_s.include?("exp") %>
							<% fieldname = "#{fieldname}_exp_tags".to_sym %>
						<% else %>
							<% fieldname = "#{fieldname}_id_tags".to_sym %>
						<% end %>
						
						<% if @response.respond_to?(fieldname) && @response.read_attribute(field).present?  %>
							<%= f.text_area fieldname, value: @response.read_attribute(fieldname).try(:sort).try(:join, ', '), multiple: true %>
							<%= f.submit "Save", class: "small" %>
						<% end %>
					</td>
				</tr>
			<% end %>
		</tbody>
	</table>
	<%= f.submit "Save" %>
<% end %>
