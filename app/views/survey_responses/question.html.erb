<h2><%= @responses.count %> Responses to "<%= @question_readable %>"</h2>

<table>
	<thead>
		<tr>
			<th>Response</th>
			<th>Answer</th>
			<th>Tags</th>
		</tr>
	</thead>
	<tbody>
		<% @responses.each do |response| %>
			<% @response_value = response.read_attribute(@question_label) %>
			<tr>
				<td class="label">
					<%= link_to response.id, response %>
				</td>
				<td>
					<% if @response_value.respond_to?(:join) %>
						<% @response_value = @response_value.sort.join(", ") %>
					<% end %>
					<%= @response_value %>
				</td>
				<td class="form-entry">
					<%= form_with model: response do |f| %>
						<% fieldname = @question_label.to_s %>
						<% if @question_label.to_s.include?("cope") %>
							<% fieldname = "#{fieldname.to_s.split("_").first}_coping_tags".to_sym %>
						<% end %>
						<%= f.text_area fieldname, value: response.read_attribute(fieldname).join(', '), multiple: true %>
						<%= f.submit "Save", class: "small" %>
					<% end %>
				</td>
			</tr>
		<% end %>
	</tbody>
</table>
